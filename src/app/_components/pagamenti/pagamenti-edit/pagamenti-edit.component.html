<div class="container">
    <mat-card class="form-card">
        <mat-card-content>
            <form *ngIf="(pagamento$ | async) || emptyForm" class="data-form flex-form" [formGroup] = "form">
                <div class="buttonsDetail">

                    <button *ngIf="!id" mat-stroked-button color="secondary" mat-dialog-close>
                        <mat-icon>arrow_back</mat-icon>
                        <div class="button-textDetail">
                            annulla
                        </div>
                    </button>

                    <button type="button" *ngIf="id" mat-stroked-button color="secondary" 
                        (click)="back()">
                        <mat-icon>arrow_back</mat-icon>
                        <div class="button-textDetail">
                            alunni
                        </div>
                    </button>

                    <button *ngIf="id" mat-stroked-button color="secondary" 
                        [disabled]= "!form.valid" 
                        (click)="loadData()">
                        <mat-icon>restart_alt</mat-icon>
                        <div class="button-textDetail">ricarica</div>
                    </button>

                    <button mat-stroked-button color="secondary" 
                        [disabled]= "!form.valid" 
                        (click)="save()"><mat-icon>save</mat-icon>
                        <div class="button-textDetail">salva</div>
                    </button>

                    <button *ngIf="id" mat-stroked-button color="warn" 
                        [disabled]= "!form.valid" 
                        (click)="delete()">
                        <mat-icon>delete_outline</mat-icon>
                        <div class="button-textDetail">elimina</div>
                    </button>
                </div>

                <mat-grid-list [cols]="breakpoint" rowHeight="60px" (window:resize)="onResize($event)">
                    <mat-grid-tile>
                        <mat-form-field>
                            <input matInput type="number" required placeholder="Importo" formControlName="importo">
                            <mat-error *ngIf="form.controls.importo.errors?.required"> Campo obbligatorio</mat-error>
                        </mat-form-field>
                    </mat-grid-tile>
                    
                    <mat-grid-tile>
                        <mat-form-field class="form-dp">
                            <input matInput
                            required
                            formControlName = "dtPagamento"
                            [matDatepicker]= "dpDtPagamento"
                            placeholder="Data di pagamento"
                            #date>
                            <mat-datepicker-toggle matSuffix [for]="dpDtPagamento"></mat-datepicker-toggle>
                            <mat-datepicker #dpDtPagamento></mat-datepicker>
                            <mat-error *ngIf="form.controls.dtPagamento.errors?.required"> Campo obbligatorio</mat-error>
                        </mat-form-field>
                    </mat-grid-tile>
                </mat-grid-list>

                <mat-grid-list [cols]="breakpoint" rowHeight="60px">
                    <mat-grid-tile>
                        <mat-form-field>
                            <input matInput type="number" required placeholder="Tipo pagamento" formControlName="tipoPagamentoID">
                        </mat-form-field>
                    </mat-grid-tile>

                    
                    <mat-grid-tile>
                        <mat-form-field>
                            <mat-label>Tipo Pagamento</mat-label>
                            <input 
                                    placeholder="<Selezionare il tipo di pagamento>"
                                    matInput
                                    formControlName="tipoPagamentoID"
                                    [matAutocomplete]="auto1">
                                    
                            <mat-autocomplete #auto1="matAutocomplete"  [displayWith]="displayFn.bind(this)">

                                <mat-spinner *ngIf="tipiPagamentoIsLoading" class="is-loading" diameter="40"></mat-spinner>
                                <mat-option *ngFor="let element of (filteredTipiPagamento$ | async)" [value]="element">
                                    <small>{{element.descrizione}}</small>
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                    </mat-grid-tile>

                </mat-grid-list>
            </form>

            <!-- <div>
                errori su campo nome: {{form.controls.nome.errors?.required}}
            </div>
            <div>
                form.valid: {{form.valid}}
            </div> -->

        </mat-card-content>
    </mat-card>
</div>
