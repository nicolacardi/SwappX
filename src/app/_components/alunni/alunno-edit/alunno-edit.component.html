<!--
/-alunno-edit 2^tab--------------------------------------------------------\
|   /-genitori-list----------------------------------------------------\   |
|   |                                                                  |   |
|   |            alunno-edit-famiglia                                  |   |
|   |                                                                  |   |
|   \------------------------------------------------------------------/   |   
|   /-genitori-list----------------------------------------------------\   |
|   |                                                                  |   |
|   |             alunno-edit-list                                     |   |
|   |                                                                  |   |
|   |                                                                  |   |
|   |                                                                  |   |
|   |                                                                  |   |
|   |                                                                  |   |
|   \------------------------------------------------------------------/   |
|                                                                          |
\--------------------------------------------------------------------------/

/-alunno-edit 3^tab--------------------------------------------------------\
|   /-classi-alunni-anni----------\         /-classi-alunni-anni-list-\    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   | classi-alunni-anni-attended |         | classi-alunni-anni-list |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   |                             |         |                         |    |
|   \-----------------------------/         \-------------------------/    |
|                                                                          |
\--------------------------------------------------------------------------/
-->

<div class="container">
    <mat-card class="form-card">
        <mat-card-content>
            <form *ngIf="(alunno$ | async) || emptyForm" class="data-form flex-form" [formGroup] = "form">
<!-- ********************************    BOTTONI     ************************************* -->
                <div class="center">
                    <button mat-mini-fab aria-label="Back" matTooltip="Back" class="btn" mat-dialog-close>
                        <mat-icon>arrow_back</mat-icon>
                    </button>

                    <button *ngIf="idAlunno" mat-mini-fab aria-label="Back" matTooltip="Back" class="btn ml10"
                            [disabled]= "!form.valid" 
                            (click)="loadData()" >
                        <mat-icon>restart_alt</mat-icon>
                    </button>

                    <button mat-mini-fab aria-label="Salva" matTooltip="Salva" class="btn ml10"
                            [disabled]= "!form.valid" 
                            (click)="save()" >
                        <mat-icon>save</mat-icon>
                    </button>

                    <button *ngIf="idAlunno" mat-mini-fab aria-label="Salva" matTooltip="Salva" class="btn ml10"
                            [disabled]= "!form.valid" 
                            (click)="delete()" >
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
                <mat-tab-group mat-align-tabs="center">
<!-- ********************************    MAT TAB ANAGRAFICA *********************************** -->
                    <mat-tab  label="Dati Anagrafici">

                        <mat-grid-list class="no-overflowx mt10" [cols]="breakpoint" rowHeight="60px" (window:resize)="onResize($event)">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" required placeholder="Nome" minlength= "3" formControlName="nome" #nome>
                                    <mat-error *ngIf="form.controls.nome.errors?.required"> Campo obbligatorio</mat-error>
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput required type="text" placeholder="Cognome" formControlName="cognome">
                                    <mat-error *ngIf="form.controls.cognome.errors?.required"> Campo obbligatorio</mat-error>
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput
                                    required
                                    formControlName = "dtNascita"
                                    [matDatepicker]= "dpDtNascita"
                                    placeholder="Data di Nascita"
                                    #date>
                                    <mat-datepicker-toggle matSuffix [for]="dpDtNascita" ></mat-datepicker-toggle>
                                    <mat-datepicker #dpDtNascita  ></mat-datepicker>
                                    <mat-error *ngIf="form.controls.dtNascita.errors?.required"> Campo obbligatorio</mat-error>
                                </mat-form-field>
                            </mat-grid-tile>
                            <mat-grid-tile class="tileCk ml15 border-left">
                                <mat-checkbox color="primary" formControlName="ckAttivo">
                                    Alunno Attivo
                                </mat-checkbox>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput required type="text" placeholder="Genere (M/F)" formControlName="genere">
                                    <mat-error>Inserire M o F</mat-error>
                                </mat-form-field>
                                
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Codice Fiscale" formControlName="cf">
                                    <mat-error>Campo errato</mat-error>
                                </mat-form-field>
                            </mat-grid-tile>
                        </mat-grid-list>

                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <mat-label>Comune di Nascita</mat-label>
                                    <input type="text"
                                            placeholder="<Selezionare il Comune>"
                                            matInput
                                            formControlName="comuneNascita"
                                            [matAutocomplete]="auto1">
                                    <mat-autocomplete #auto1="matAutocomplete" >
                                        <!--<mat-option *ngIf="comuniNascitaIsLoading" class="is-loading"><mat-spinner diameter="30"></mat-spinner></mat-option>-->
                                        <mat-spinner *ngIf="comuniNascitaIsLoading" class="is-loading" diameter="40"></mat-spinner>
                                        <mat-option *ngFor="let element of (filteredComuniNascita$ | async)" [value]="element.comune" (click)="popolaProvNascita(element.provincia)">
                                            <small>{{element.comune}}</small>
                                            <!-- <small> - {{element.provincia}}</small> -->
                                        </mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Prov di Nascita" formControlName="provNascita">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Paese di Nascita" formControlName="nazioneNascita">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk ml15 border-left">
                                <mat-checkbox color="primary" formControlName="ckDSA">
                                    Alunno con DSA
                                </mat-checkbox>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <mat-label>Comune di Residenza</mat-label>
                                    <input type="text"
                                            placeholder="<Selezionare il Comune>"
                                            matInput
                                            formControlName="comune"
                                            [matAutocomplete]="auto2">
                                    <mat-autocomplete #auto2="matAutocomplete" >
                                        <mat-spinner *ngIf="comuniIsLoading" class="is-loading" diameter="40"></mat-spinner>
                                        <ng-container >
                                            <mat-option *ngFor="let element of (filteredComuni$ | async)" [value]="element.comune" (click)="popolaProv(element.provincia,  element.cap)">
                                                <small>{{element.comune}}</small>
                                                <!-- <small> - {{element.provincia}}</small> -->
                                            </mat-option>
                                        </ng-container>
                                    </mat-autocomplete>
                                </mat-form-field>
                            </mat-grid-tile>
                    

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Prov di Residenza" formControlName="prov">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Paese di Residenza" formControlName="nazione">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk ml15 border-left" >
                                <mat-checkbox color="primary" formControlName="ckDisabile">
                                    Alunno Disabile
                                </mat-checkbox>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <input  matInput type="text" placeholder="Indirizzo e N. Civico" formControlName="indirizzo">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="CAP" formControlName="cap">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk">

                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk ml15 border-left">
                                <mat-checkbox color="primary" formControlName="ckAuthFoto">
                                    Autorizz. Uso Foto
                                </mat-checkbox>
                            </mat-grid-tile>
                        </mat-grid-list>

                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Telefono" formControlName="telefono">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="e-mail" formControlName="email">
                                    <mat-error>Campo errato</mat-error>
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk">

                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk ml15 border-left">
                                <mat-checkbox color="primary" formControlName="ckAuthUscite">
                                    Autorizz. Uscite
                                </mat-checkbox>
                            </mat-grid-tile>

                        </mat-grid-list>

                        <mat-grid-list class="no-overflowx" [cols]="breakpoint" rowHeight="60px">
                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Scuola di provenienza" formControlName="scuolaProvenienza">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile>
                                <mat-form-field>
                                    <input matInput type="text" placeholder="Indirizzo Scuola di provenienza" formControlName="indirizzoScuolaProvenienza">
                                </mat-form-field>
                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk">

                            </mat-grid-tile>

                            <mat-grid-tile class="tileCk ml15 border-left">
                                <mat-checkbox color="primary" formControlName="ckAuthUsoMateriale">
                                    Autorizz. Uso Mat.
                                </mat-checkbox>
                            </mat-grid-tile>

                        </mat-grid-list>
                        
                    </mat-tab>
<!-- ********************************    MAT TAB GENITORI ************************************ -->
                    <mat-tab label="Famiglia">    
                        <button mat-mini-fab aria-label="Nuova anagrafica Genitore" matTooltip="Nuova anagrafica Genitore" class= "btn btn-addModal" (click)="addGenitore()">
                            <mat-icon>add</mat-icon>
                        </button>
                        <mat-label class="frameLabel">i genitori/tutori di {{nome.value}} </mat-label>
                        <div class="genitori-container cellBordered mt10">
                            <app-genitori-list [dove]="'alunno-edit-famiglia'"[alunnoId]="idAlunno"  (removeFromFamily) = "removeFromFamily($event)" #genitoriFamiglia></app-genitori-list>
                        </div>
                        <mat-accordion>
                            <mat-expansion-panel hideToggle>
                              <mat-expansion-panel-header>
                                <mat-panel-title>
                                  Elenco di tutti i genitori/tutori
                                </mat-panel-title>
                                <mat-panel-description>
                                  (fare click per aprire)
                                </mat-panel-description>
                              </mat-expansion-panel-header>
                                <mat-label class="frameLabel">Elenco dei genitori/tutori </mat-label>
                                <div class="genitori-list-container cellBordered mt10">
                                    <app-genitori-list [dove]="'alunno-edit-list'" (addToFamily) = "addToFamily($event)"></app-genitori-list>
                                </div>
                            </mat-expansion-panel>
                        </mat-accordion>

                    </mat-tab>
<!-- ********************************    MAT TAB CLASSI    ************************************* -->
                    <mat-tab label="Classi Frequentate" style="overflow-x: hideen;">
                        <table>
                            <tr>
                                <td>
                                    <mat-label class="frameLabel">Le classi frequentate da {{nome.value}} </mat-label>
                                    <div class="classi-attended-container cellBordered mt10">
                                        <app-classi-sezioni-anni-list [alunnoId] = "idAlunno" [dove] = "'alunno-edit-attended'"
                                        (removeFromAttended) = "removeFromAttended($event)"
                                        #classiSezioniAnniAttended></app-classi-sezioni-anni-list>
                                    </div>
                                </td>
                                <td class="td-vertical-accordion">
                                    <mat-accordion class="rotated-accordion">
                                        <mat-expansion-panel hideToggle>
                                            <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Tutte le classi
                                            </mat-panel-title>
                                            <mat-panel-description>
                                                (fare click per aprire)
                                            </mat-panel-description>
                                            </mat-expansion-panel-header>
                                            <mat-label class="frameLabel le480">Elenco delle classi</mat-label>
                                            <div class="panel-content classi-list-container cellBordered mt10">
                                            
                                            <app-classi-sezioni-anni-list
                                                [dove] = "'alunno-edit-list'"
                                                (addToAttended) = "addToAttended($event)"
                                                #classiSezioniAnniList>
                                            </app-classi-sezioni-anni-list>
                                            </div>
                                        </mat-expansion-panel>
                                    </mat-accordion>  
                                </td>
                            </tr>
                        </table>
                    </mat-tab>
<!-- ********************************    MAT TAB PAGELLE ************************************** -->
                    <mat-tab label="Pagelle">

                    </mat-tab>
<!-- ********************************    MAT TAB VOTI    ************************************** -->
                    <mat-tab label="Voti">

                    </mat-tab>
<!-- ********************************    MAT TAB ASSENZE ************************************** -->
                    <mat-tab label="Assenze">

                    </mat-tab>
                </mat-tab-group>    
            </form>
        </mat-card-content>
    </mat-card>
</div>
